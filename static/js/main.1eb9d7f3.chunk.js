(this.webpackJsonpprocess_simulation=this.webpackJsonpprocess_simulation||[]).push([[0],{42:function(t,e,a){t.exports=a(52)},47:function(t,e,a){},48:function(t,e,a){},51:function(t,e,a){},52:function(t,e,a){"use strict";a.r(e);var n=a(1),i=a.n(n),s=a(24),o=a.n(s),r=(a(47),a(48),a(0)),d=a(25),c=a.n(d);var l=function(){let t=100,e=100,a="x",n=20,i={};const s={};return s.arrange=function(s){const o=function(s){const o=r.c().key(t=>t[a]).rollup(t=>t.length).entries(s).sort((t,e)=>e.value-t.value);i={},o.length<2*n&&(n/=2);const d=Math.ceil(o.length/n),c=r.g().range([0,t]).padding(.05).domain(r.d(0,n,1));let l=e;const h=r.g().range([0,l]).padding(.05).domain(r.d(0,d,1));return o.forEach((t,e)=>{const a=e%n,s=Math.floor(e/n);i[t.key]={index:e,id:t.key,count:t.value,x:c(a),y:h(s),col:a,row:s}}),t=>i[t]}(s);return s.forEach(t=>{const e=o(t[a]);t.gridx=e.x,t.gridy=e.y}),this},s.grid=function(){return Object.values(i)},s.key=function(t){return arguments.length?(a=t,s):a},s.width=function(e){return arguments.length?(t=e,s):t},s.height=function(t){return arguments.length?(e=t,s):e},s.cols=function(t){return arguments.length?(n=t,s):n},s};a(51);let h=!1,m=!1;const p={1:{id:1,name:"Type 1",color:"#E8871A"},2:{id:2,name:"Type 2",color:"#DA3390"},3:{id:3,name:"Type 3",color:"#5144D3"},4:{id:4,name:"Type 4",color:"#00C0C7"}},u={Phase1:0,Phase2:0,Phase3:0,Start:0,Combination:0,Hit:0,Improvement2:0,Improvement1:0};function g(t){const e=t.index%2===0?"Improvement2":"Improvement1";m?27!==u.Improvement1&&(u.Improvement1=27):(u[e]+=Math.round(10*Math.random())/10,u.Hit+=1)}function x(t,e){return Math.random()*(e-t)+t}console.time("animation");let f=!1;function b(t){return t.hts=x(0,20),t.tank=x(10,20),t.built=Math.random()>.3,t.promoted=t.hts>19.7,t.designed=Math.random()>.3,t.built=Math.random()>.3,t.hit=Math.random()>.8,m&&(t.built=!1,t.promoted=!1,t.designed=!1,t.hit=!1,t.tank=0,t.hts=0),t.type=function(t){let e=1;if(Math.random()>.5)e=1;else{e=Math.round(x(2,4))}return e}(),t}function y(t,e){const a=t.elapsed;b(t),u.Phase2<30200?P(t,e):(f||(f=!0,m=!0),t.transEnd=!0),t.elapsed=a}function v(t){const e={index:t,elapsed:0};return b(e),e.static={},e}const w=function(t){return 10*t.index*Math.random()},E=function(t){return 10*t.index},k=r.f().domain([0,1800]).range([0,1]).clamp(!0),S=r.f().domain([0,200]).range([0,1]).clamp(!0),M=r.f().domain([0,4e3]).range([0,1]).clamp(!0);function A(t,e,a,n){const i=k,s=n-408,o=e.length%20+1>10?1:0,d=e.length%10*15;t.forEach((e,n)=>{e.trans=[{id:0===n?"combicon":"combicon-extra",x:r.b(e.gridx+a(3),a(4)+d),y:r.b(e.gridy,s+8*n+224*o),delay:500,duration:i.domain()[1],timeScale:i,ease:r.a}],e.transIndex=0,e.transEnd=!1,e.combicount=t.length,e.timeRatio=h?.6:1})}function P(t,e){const a=k,n=M,i=S;t.trans=[{id:"design",color:()=>p[t.type].color,y:()=>t.design.y,x:()=>t.design.x,r:r.b(0,4),delay:t.index,duration:i.domain()[1],timeScale:i,ease:r.a},{id:"wait",delay:E(t),duration:a.domain()[1],timeScale:a,ease:r.a},{id:"build",y:r.b(t.design.y,t.gridy),x:r.b(t.design.x,t.gridx+e(1)),delay:w(t),timeScale:n,duration:n.domain()[1],ease:r.a}],t.built?t.trans.push({id:"hts",x:r.b(t.gridx+e(1),t.gridx+e(2)),delay:w(t),timeScale:a,duration:a.domain()[1],ease:r.a}):t.trans.push({color:r.b(p[t.type].color,"rgba(255,255,255,0)"),delay:w(t),timeScale:i,duration:i.domain()[1],ease:r.a}),t.built&&t.promoted?t.trans.push({id:"tank",x:r.b(t.gridx+e(2),t.gridx+e(3)),delay:w(t),timeScale:a,duration:a.domain()[1],ease:r.a}):t.built&&t.trans.push({color:r.b(p[t.type].color,"rgba(255,255,255,0)"),delay:w(t),timeScale:i,duration:i.domain()[1],ease:r.a}),t.timeRatio=h?.6:1,t.transIndex=0,t.elapsed=0,t.transEnd=!1}function C(t,e,a){l().width(e.bandwidth()).height(a).key("index").arrange(t);const n=a/2,i=e.bandwidth()/2,s=e.bandwidth()/2-20,o=t.length;return t.forEach((function(t){t.design=function(t,e,a,n,i){const s=360/i,o=(t-=200)*(Math.PI/180);return{x:a+e*Math.cos(o*s),y:n+e*Math.sin(o*s)}}(t.index,s,i,n,o),P(t,e)})),t}class I extends n.Component{componentDidMount(){this.setup(),this.update()}componentDidUpdate(){this.update()}setup(){const t=this.props.data;this.data=t;const e=r.h(this.side),a=r.h(this.bottom);this.ended=!1,this.sideG=e.append("g"),this.bottomG=a.append("g"),this.yAxis=this.sideG.append("g").classed("y-axis",!0),this.yAxisLabel=this.sideG.append("text").attr("class","axis-label").attr("text-anchor","middle"),this.xAxis=this.bottomG.append("g").classed("x-axis",!0),this.static={build:[],hts:[],tank:[],types:{1:[],2:[],3:[],4:[]}},this.tanks={},this.combis=[],this.rawTime=0,this.endModeTicks=0}moveCircles(t){const e=this.props,a=e.gridScale,n=e.plotHeight,i=["x","y","color","r"];this.rawTime=t,m&&(this.endModeTicks+=1);const s=this,o=this.data.length,r=[];for(let c=0;c<o;c++){const e=this.data[c];if(e.timeRatio||(e.timeRatio=h?.6:1),!e.transEnd){const o=t-e.elapsed*e.timeRatio,l=e.transIndex,p=e.trans[l],x=p.timeScale,f=p.delay*e.timeRatio,b=p.ease(x(o-f));if(i.forEach(t=>{p[t]&&(e[t]=p[t](b))}),b>=1){let i=Math.random()>.6;if("ending"===p.id&&e.endingKeep){const t={x:e.x,y:e.y};s.static.types[e.type].push(t)}if("design"===p.id)u.Start+=1,!h&&u.Start>=7e3&&(h=!0);else if("build"===p.id){if(u.Phase1+=1,!e.static.build&&i){const t={x:e.x,y:e.y};s.static.build.push(t),s.static.types[e.type].push(t),e.static.build=!0}}else if("hts"===p.id){if(u.Phase2+=1,!e.static.hts&&i){const t={x:e.x,y:e.y};s.static.hts.push(t),s.static.types[e.type].push(t),e.static.hts=!0}}else if("tank"===p.id){u.Phase3+=1,e.hit&&(console.log("hit"),g(e));const t={x:e.x,y:e.y};s.static.tank.push(t),s.static.types[e.type].push(t),m&&(e.combi=!0)}else"combicon"===p.id&&(u.Combination+=10*e.combicount);if(e.elapsed=t,e.transIndex+=1,e.endingKeep?e.timeRatio=1:e.timeRatio=h?.6:1,e.transIndex>=e.trans.length)if(e.built&&e.promoted&&!e.combi){e.transEnd=!0;const i=[Object.assign({},e)],o=Object.keys(s.tanks);if(o.length>9){const t=Math.min(Math.round(o.length/10)+1,23);for(let e=0;e<t;e++){const t=(d=o)[Math.floor(Math.random()*d.length)];i.push(Object.assign({},s.tanks[t]))}}i.length>1&&!m&&(A(i,s.combis,a,n),i.forEach(e=>{e.combi=!0,e.elapsed=t,s.data.push(e)}),s.combis.push(i)),s.tanks[e.index]=e}else e.combi?(e.transEnd=!0,e.endingKeep||r.push(c)):y(e,a)}}}var d;this.data=this.data.filter((function(t,e){return-1===r.indexOf(e)})),this.updateCanvas()}endAnimation(){const t=this.props,e=t.gridScale,a=t.plotHeight;if(!this.ended){this.ended=!0,console.timeEnd("animation"),function(t,e,a,n){const i=k,s=a-408,o=t.length-1,d=e(4)+e.bandwidth()/2;t.forEach((t,e)=>{t.forEach((t,a)=>{t.combiX=t.x,t.combiY=t.y,t.combiColor=t.color;const c=e===o?p[t.type].color:"rgba(255,255,255,0)";t.trans=[{color:r.b(p[t.type].color,c),delay:1400,duration:i.domain()[1],timeScale:i,ease:r.a},{id:"ending",x:r.b(t.combiX,d),y:r.b(t.combiY,s+8*a),delay:100,duration:i.domain()[1],timeScale:i,ease:r.a}],t.endingKeep=e===o,t.transIndex=0,t.transEnd=!1,t.endNode=!0,t.elapsed=n,t.timeRatio=1})})}(this.combis,e,a,this.rawTime),console.log(this.combis);const t=this;this.combis.forEach(e=>{e.forEach(e=>{t.data.push(Object.assign({},e))})}),console.log("data"),console.log(this.data)}}update(){const t=this.props.padding;this.sideG.attr("transform","translate(".concat(t.left," ").concat(t.top,")")),this.bottomG.attr("transform","translate(".concat(t.left," 0)")),this.timer=r.i(this.moveCircles.bind(this)),this.updateAxes()}updateCanvas(){const t=this.props,e=t.sizeScale,a=t.gridScale,n=t.plotHeight,i=t.width,s=t.height,o=t.padding,r=this.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0),r.scale(e,e),r.clearRect(0,0,i,s),r.translate(o.left,o.top);const d=a.bandwidth(),c=2*d;!function(t,e,a,n,i,s,o){const r=e+n,d=a+i,c=e+n/2,l=a+i/2;t.save(),t.beginPath(),t.moveTo(e,l),t.quadraticCurveTo(e,a,c,a),t.quadraticCurveTo(r,a,r,l),t.quadraticCurveTo(r,d,c,d),t.quadraticCurveTo(e,d,e,l),s&&(t.strokeStyle=s),o&&(t.lineWidth=o),t.stroke(),t.restore()}(r,0,n/2-c/2,d,c,"#D5D5D6",5);const l=2*Math.PI;if([1,2,3,4].forEach(t=>{r.beginPath(),r.fillStyle=p[t].color,this.static.types[t].forEach(t=>{r.moveTo(t.x+4,t.y),r.arc(t.x,t.y,4,0,l)}),r.fill()}),this.endModeTicks<20){const t=this.combis.slice(Math.max(this.combis.length-40,0)),e=t.length;for(let a=0;a<e;a++){t[a].forEach(t=>{r.beginPath(),r.arc(t.x,t.y,t.r,0,l,!1),r.fillStyle=t.color,r.fill()})}}const h=this.data.length;for(let m=0;m<h;m++){const t=this.data[m];r.beginPath(),r.arc(t.x,t.y,t.r,0,l,!1),r.fillStyle=t.color,r.fill()}m&&this.endAnimation()}updateAxes(){const t=this.props,e=t.gridScale,a=t.plotHeight,n=["Start","Phase1","Phase2","Phase3","Improvement","Combination"],i=["Improvement1","Improvement2"],s=Object.keys(p),o=this.xAxis.selectAll(".key").data(s).enter();o.append("text").classed("key",!0).text(t=>p[t].name).attr("text-anchor","start").attr("y",(t,e)=>a-(s.length-30*(e-1))).attr("x",16),o.append("circle").attr("fill",t=>p[t].color).attr("r",4).attr("cx",8).attr("cy",(t,e)=>a-(s.length-30*(e-1))-6);const d=this.xAxis.selectAll(".label").data(n).enter();d.append("text").classed("label",!0).text(t=>t).attr("text-anchor","start").attr("y",(t,e)=>e>4?a/2-20-20:30).attr("x",(t,a)=>e(a>4?a-1:a)),d.append("text").classed("count",!0).text(t=>t).attr("text-anchor","end").attr("y",(t,e)=>e>4?a/2-20-20:30).attr("x",(t,a)=>a>4?e(a-1)+e.bandwidth():e(a)+e.bandwidth()),d.append("line").attr("x1",(t,a)=>e(a>4?a-1:a)).attr("x2",(t,a)=>a>4?e(a-1)+e.bandwidth():e(a)+e.bandwidth()).attr("y1",(t,e)=>e>4?a/2-20-10:40).attr("y2",(t,e)=>e>4?a/2-20-10:40).attr("stroke-width",2).attr("stroke","#222"),this.xAxis.selectAll(".metric").data(i).enter().append("text").classed("metric",!0).text(t=>"".concat(t,":")).attr("text-anchor","start").attr("y",(t,e)=>30*e+70).attr("x",e(4)),this.xAxis.selectAll(".metric-value").data(i).enter().append("text").classed("metric metric-value",!0).text(t=>"".concat(u[t].toFixed(2),"%")).attr("text-anchor","end").attr("y",(t,e)=>30*e+70).attr("x",e(4)+e.bandwidth());const c=this,l=Object.keys(u);r.i((function(){c.xAxis.selectAll(".count").text((t,e)=>l.includes(t)?"".concat(u[n[e]]):""),c.xAxis.selectAll(".metric-value").text(t=>"".concat(u[t].toFixed(2),"%"))}))}render(){const t=this.props,e=t.sizeScale,a=t.width,n=t.height,s=t.padding;let o={width:a,height:n};return i.a.createElement("div",{className:"StrainProcess",onClick:this.handleClick,style:{height:n}},i.a.createElement("svg",{className:"chart-side",ref:t=>{this.side=t},width:s.left,height:n}),i.a.createElement("svg",{className:"chart-bottom",ref:t=>{this.bottom=t},width:a,height:n}),i.a.createElement("canvas",{className:"chart",ref:t=>{this.canvas=t},style:o,width:a*e,height:n*e}))}}I.defaultProps={data:[],width:1e3,height:750};var T=c()((function(t){const e=t.height,a=t.width,n=function(t){const e=[];for(let a=0;a<t;a++)e.push(v(a));return e}(1e3),i={top:55,right:10,bottom:15,left:40};let s=1;window.devicePixelRatio&&(s=window.devicePixelRatio);const o=a-i.left-i.right,d=e-i.top-i.bottom,c=r.e().domain(r.d(0,5)).range([0,o]).paddingInner(.2);return C(n,c,d),{data:n,padding:i,plotWidth:o,plotHeight:d,sizeScale:s,gridScale:c}}))(I);class R extends n.Component{constructor(t){super(t),this.state={data:[]}}render(){return i.a.createElement("div",null,i.a.createElement(T,Object.assign({data:this.state.data},this.props)))}}R.defaultProps={};var O=R;class j extends n.Component{render(){return i.a.createElement("div",{className:"App"},i.a.createElement(O,null))}}var D=j;o.a.render(i.a.createElement(D,null),document.getElementById("root"))}},[[42,1,2]]]);
//# sourceMappingURL=main.1eb9d7f3.chunk.js.map